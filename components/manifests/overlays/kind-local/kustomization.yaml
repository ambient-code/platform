apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Layer on top of the kind overlay, overriding only image sources and pull policy
resources:
- ../kind

# Override operator env to use locally-built runner/state-sync images
patches:
- path: operator-env-patch.yaml
  target:
    kind: Deployment
    name: agentic-operator

# Override imagePullPolicy to IfNotPresent for all deployments
- path: image-pull-policy-patch.yaml
  target:
    group: apps
    version: v1
    kind: Deployment
    name: backend-api
- path: image-pull-policy-patch.yaml
  target:
    group: apps
    version: v1
    kind: Deployment
    name: frontend
- path: image-pull-policy-patch.yaml
  target:
    group: apps
    version: v1
    kind: Deployment
    name: agentic-operator
- path: image-pull-policy-patch.yaml
  target:
    group: apps
    version: v1
    kind: Deployment
    name: public-api

# Remap images from Quay.io to locally-built names
# Podman tags images with localhost/ prefix, which kind preserves when loading
images:
- name: quay.io/ambient_code/vteam_backend
  newName: localhost/vteam_backend
  newTag: latest
- name: quay.io/ambient_code/vteam_frontend
  newName: localhost/vteam_frontend
  newTag: latest
- name: quay.io/ambient_code/vteam_operator
  newName: localhost/vteam_operator
  newTag: latest
- name: quay.io/ambient_code/vteam_public_api
  newName: localhost/vteam_public_api
  newTag: latest
