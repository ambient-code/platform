// Code generated by ambient-sdk-generator from openapi.yaml â€” DO NOT EDIT.
// Source: {{.Header.SpecPath}}
// Spec SHA256: {{.Header.SpecHash}}
// Generated: {{.Header.Timestamp}}

package client

import (
	"context"
	"encoding/json"
	"fmt"
	"net/http"

	"github.com/ambient-code/platform/components/ambient-sdk/go-sdk/types"
)

type {{.Resource.Name}}API struct {
	client *Client
}

func (c *Client) {{.Resource.Plural}}() *{{.Resource.Name}}API {
	return &{{.Resource.Name}}API{client: c}
}

func (a *{{.Resource.Name}}API) Create(ctx context.Context, resource *types.{{.Resource.Name}}) (*types.{{.Resource.Name}}, error) {
	body, err := json.Marshal(resource)
	if err != nil {
		return nil, fmt.Errorf("marshal {{.Resource.Name | snakeCase}}: %w", err)
	}
	var result types.{{.Resource.Name}}
	if err := a.client.do(ctx, http.MethodPost, "/{{.Resource.PathSegment}}", body, http.StatusCreated, &result); err != nil {
		return nil, err
	}
	return &result, nil
}

func (a *{{.Resource.Name}}API) Get(ctx context.Context, id string) (*types.{{.Resource.Name}}, error) {
	var result types.{{.Resource.Name}}
	if err := a.client.do(ctx, http.MethodGet, "/{{.Resource.PathSegment}}/"+id, nil, http.StatusOK, &result); err != nil {
		return nil, err
	}
	return &result, nil
}

func (a *{{.Resource.Name}}API) List(ctx context.Context, opts *types.ListOptions) (*types.{{.Resource.Name}}List, error) {
	var result types.{{.Resource.Name}}List
	if err := a.client.doWithQuery(ctx, http.MethodGet, "/{{.Resource.PathSegment}}", nil, http.StatusOK, &result, opts); err != nil {
		return nil, err
	}
	return &result, nil
}

{{- if .Resource.HasPatch}}
func (a *{{.Resource.Name}}API) Update(ctx context.Context, id string, patch map[string]any) (*types.{{.Resource.Name}}, error) {
	body, err := json.Marshal(patch)
	if err != nil {
		return nil, fmt.Errorf("marshal patch: %w", err)
	}
	var result types.{{.Resource.Name}}
	if err := a.client.do(ctx, http.MethodPatch, "/{{.Resource.PathSegment}}/"+id, body, http.StatusOK, &result); err != nil {
		return nil, err
	}
	return &result, nil
}
{{end}}
{{- if .Resource.HasDelete}}
func (a *{{.Resource.Name}}API) Delete(ctx context.Context, id string) error {
	return a.client.do(ctx, http.MethodDelete, "/{{.Resource.PathSegment}}/"+id, nil, http.StatusNoContent, nil)
}
{{end}}
{{- if .Resource.HasStatusPatch}}
func (a *{{.Resource.Name}}API) UpdateStatus(ctx context.Context, id string, patch map[string]any) (*types.{{.Resource.Name}}, error) {
	body, err := json.Marshal(patch)
	if err != nil {
		return nil, fmt.Errorf("marshal status patch: %w", err)
	}
	var result types.{{.Resource.Name}}
	if err := a.client.do(ctx, http.MethodPatch, "/{{.Resource.PathSegment}}/"+id+"/status", body, http.StatusOK, &result); err != nil {
		return nil, err
	}
	return &result, nil
}
{{end}}
{{- range .Resource.Actions}}
func (a *{{$.Resource.Name}}API) {{. | title}}(ctx context.Context, id string) (*types.{{$.Resource.Name}}, error) {
	var result types.{{$.Resource.Name}}
	if err := a.client.do(ctx, http.MethodPost, "/{{$.Resource.PathSegment}}/"+id+"/{{.}}", nil, http.StatusOK, &result); err != nil {
		return nil, err
	}
	return &result, nil
}
{{end}}
func (a *{{.Resource.Name}}API) ListAll(ctx context.Context, opts *types.ListOptions) *Iterator[types.{{.Resource.Name}}] {
	return NewIterator(func(page int) (*types.{{.Resource.Name}}List, error) {
		o := *opts
		o.Page = page
		return a.List(ctx, &o)
	})
}
