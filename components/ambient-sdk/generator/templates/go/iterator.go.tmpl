// Code generated by ambient-sdk-generator from openapi.yaml â€” DO NOT EDIT.
// Source: {{.Header.SpecPath}}
// Spec SHA256: {{.Header.SpecHash}}
// Generated: {{.Header.Timestamp}}

package client

type Listable[T any] interface {
	GetItems() []T
	GetTotal() int
	GetPage() int
	GetSize() int
}

type Iterator[T any] struct {
	fetchPage func(page int) (Listable[T], error)
	items     []T
	index     int
	page      int
	total     int
	done      bool
	err       error
}

func NewIterator[T any, L Listable[T]](fetchPage func(page int) (L, error)) *Iterator[T] {
	return &Iterator[T]{
		fetchPage: func(page int) (Listable[T], error) {
			return fetchPage(page)
		},
		page:  0,
		index: -1,
	}
}

func (it *Iterator[T]) Next() bool {
	if it.done || it.err != nil {
		return false
	}
	it.index++
	if it.index < len(it.items) {
		return true
	}
	it.page++
	result, err := it.fetchPage(it.page)
	if err != nil {
		it.err = err
		return false
	}
	it.items = result.GetItems()
	it.index = 0
	it.total = result.GetTotal()
	if len(it.items) == 0 {
		it.done = true
		return false
	}
	return true
}

func (it *Iterator[T]) Item() T {
	return it.items[it.index]
}

func (it *Iterator[T]) Err() error {
	return it.err
}
