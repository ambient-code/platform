// Code generated by ambient-sdk-generator from openapi.yaml â€” DO NOT EDIT.
// Source: {{.Header.SpecPath}}
// Spec SHA256: {{.Header.SpecHash}}
// Generated: {{.Header.Timestamp}}

import type { AmbientClientConfig } from './base';
{{range .Spec.Resources}}import { {{.Name}}API } from './{{.Name | snakeCase}}_api';
{{end}}

export class AmbientClient {
  private readonly config: AmbientClientConfig;
{{range .Spec.Resources}}
  readonly {{.Plural | lowerFirst}}: {{.Name}}API;
{{- end}}

  constructor(config: AmbientClientConfig) {
    if (!config.baseUrl) {
      throw new Error('baseUrl is required');
    }
    if (!config.token) {
      throw new Error('token is required');
    }
    if (config.token.length < 20) {
      throw new Error('token is too short (minimum 20 characters)');
    }
    if (config.token === 'YOUR_TOKEN_HERE' || config.token === 'PLACEHOLDER_TOKEN') {
      throw new Error('placeholder token is not allowed');
    }
    if (!config.project) {
      throw new Error('project is required');
    }
    if (config.project.length > 63) {
      throw new Error('project name cannot exceed 63 characters');
    }

    const url = new URL(config.baseUrl);
    if (url.protocol !== 'http:' && url.protocol !== 'https:') {
      throw new Error('only HTTP and HTTPS schemes are supported');
    }

    this.config = {
      ...config,
      baseUrl: config.baseUrl.replace(/\/+$/, ''),
    };

{{range .Spec.Resources}}    this.{{.Plural | lowerFirst}} = new {{.Name}}API(this.config);
{{end}}  }

  static fromEnv(): AmbientClient {
    const baseUrl = process.env.AMBIENT_API_URL || 'http://localhost:8080';
    const token = process.env.AMBIENT_TOKEN;
    const project = process.env.AMBIENT_PROJECT;

    if (!token) {
      throw new Error('AMBIENT_TOKEN environment variable is required');
    }
    if (!project) {
      throw new Error('AMBIENT_PROJECT environment variable is required');
    }

    return new AmbientClient({ baseUrl, token, project });
  }
}
